# MySQL

## æ¦‚å¿µæ¨¡å‹çš„æœ¯è¯­

## ğŸ¬**å®ä½“**

å®ä½“(Entity)æ˜¯æŒ‡å®¢è§‚å­˜åœ¨å¹¶å¯ç›¸äº’åŒºåˆ†çš„äº‹ç‰©ï¼Œå¦‚å­¦ç”Ÿã€ç­çº§ã€è¯¾ç¨‹ã€‚

## ğŸ¬**å±æ€§**

å±æ€§(Attribute)æ˜¯æŒ‡å®ä½“æ‰€å…·æœ‰çš„æŸä¸€ç‰¹æ€§ï¼Œä¸€ä¸ªå®ä½“å¯ä»¥ç”±è‹¥å¹²ä¸ªå±æ€§æ¥æè¿°ã€‚

egï¼š å­¦ç”Ÿçš„å®ä½“å±æ€§æœ‰å­¦å· ã€å­¦ç”Ÿå§“åç­‰ã€‚å±æ€§ç”±ä¸¤éƒ¨åˆ†ç»„æˆ å±æ€§åå’Œå±æ€§å€¼

# SQLåˆ†ç±»

é»˜è®¤å­—ç¬¦é›†ä½¿ç”¨çš„ UTF-8

## DCL 

æ•°æ®å®šä¹‰è¯­è¨€ï¼Œç”¨æ¥å®šä¹‰æ•°æ®åº“å¯¹è±¡(æ•°æ®åº“ï¼Œè¡¨ï¼Œå­—æ®µ)

### åˆ›å»ºæ•°æ®åº“

```sql
create database [if not exists] æ•°æ®åº“å [default charset utf-8]
eg: create database if not exists selfDB default charset utf8mb4

```

## æ•°æ®ç±»å‹

### æ•°å€¼ç±»å‹

![image-20230325161230321](https://halo-1308808626.cos.ap-guangzhou.myqcloud.com/images/202303251612444.png)

- å¹´é¾„å­—æ®µ -- ä¸ä¼šå‡ºç°è´Ÿæ•° è€Œä¸”äººçš„å¹´é¾„ä¸ä¼šå¤ªå¤§ 

  ```sql
  age tinyint unsigned
  ```

- åˆ†æ•° -- æ€»åˆ† 100åˆ† æœ€å¤šå‡ºç°ä»¥ä¸ºå°æ•°

  ```sql
  score doble(4,1)
  ```

### å­—ç¬¦ä¸²ç±»å‹

![image-20230325161541121](https://halo-1308808626.cos.ap-guangzhou.myqcloud.com/images/202303251615175.png)

å…¶ä¸­ charä¸varcharæè¿°å­—ç¬¦ä¸² charæ˜¯å®šé•¿å­—ç¬¦ä¸² æŒ‡å®šé•¿åº¦å¤šé•¿ï¼Œå°±å ç”¨å¤šå°‘ä¸ªå­—ç¬¦ï¼Œå’Œå­—æ®µå€¼çš„é•¿åº¦æ— å…³ ã€‚è€Œvarcharæ˜¯å˜é•¿å­—ç¬¦ä¸²ï¼ŒæŒ‡å®šçš„é•¿åº¦ä¸ºæœ€å¤§å ç”¨é•¿åº¦ ã€‚ç›¸å¯¹æ¥è¯´ï¼Œcharçš„æ€§èƒ½ä¼šæ›´é«˜äº›ã€‚

```sql
1). ç”¨æˆ·å username ------> é•¿åº¦ä¸å®š, æœ€é•¿ä¸ä¼šè¶…è¿‡50
username varchar(50)
2). æ€§åˆ« gender ---------> å­˜å‚¨å€¼, ä¸æ˜¯ç”·,å°±æ˜¯å¥³
gender char(1)
3). æ‰‹æœºå· phone --------> å›ºå®šé•¿åº¦ä¸º11
phone char(11)
```

### æ—¥æœŸæ—¶é—´ç±»å‹

![image-20230325161917423](https://halo-1308808626.cos.ap-guangzhou.myqcloud.com/images/202303251619468.png)



## DML

æ•°æ®æ“ä½œè¯­è¨€ï¼Œç”¨æ¥å¯¹æ•°æ®åº“è¡¨ä¸­çš„æ•°æ®è¿›è¡Œå¢åˆ æ”¹



## DQL

æ•°æ®æŸ¥è¯¢è¯­è¨€ï¼Œç”¨æ¥æŸ¥è¯¢æ•°æ®åº“ä¸­è¡¨çš„è®°å½•

### æŸ¥è¯¢è¯­æ³•

```sql
select å­—æ®µåˆ—è¡¨ from è¡¨ååˆ—è¡¨
where æ¡ä»¶åˆ—è¡¨ group by åˆ†ç»„å­—æ®µåˆ—è¡¨
having åˆ†ç»„åæ¡ä»¶åˆ—è¡¨
order by æ’åºå­—æ®µåˆ—è¡¨
limit åˆ†é¡µå‚æ•°
```

### å…³äºèšåˆå‡½æ•°

å°†ä¸€åˆ—æ•°æ®ä½œä¸ºä¸€ä¸ªæ•´ä½“ è¿›è¡Œçºµå‘è®¡ç®—

| å‡½æ•°  | åŠŸèƒ½     |
| ----- | -------- |
| count | ç»Ÿè®¡æ•°é‡ |
| max   | æœ€å¤§å€¼   |
| min   | æœ€å°å€¼   |
| avg   | å¹³å‡å€¼   |
| sum   | æ±‚å’Œ     |



```sql
select èšåˆå‡½æ•°(å­—æ®µåˆ—è¡¨) from è¡¨å;
# NULLå€¼ä¸å‚ä¸æ‰€æœ‰èšåˆå‡½æ•°è¿ç®—çš„
```

```sql
egï¼š ç»Ÿè®¡ä¼ä¸šå‘˜å·¥æ•°é‡
select count(*) from emp;-- ç»Ÿè®¡çš„æ˜¯æ€»è®°å½•æ•°
select count(idCard) from emp; -- ç»Ÿè®¡çš„æ˜¯idCardå­—æ®µä¸ä¸ºnullçš„è®°å½•æ•°

# å¯¹äºcountèšåˆå‡½æ•°ï¼Œç»Ÿè®¡ç¬¦åˆæ¡ä»¶çš„æ€»è®°å½•æ•°ï¼Œè¿˜å¯ä»¥é€šè¿‡ count(æ•°å­—æˆ–è€…å­—ç¬¦ä¸²)çš„å½¢å¼è¿›è¡Œç»Ÿè®¡æŸ¥è¯¢
select count(1) from emp;

select avg(age) from emp; # ç»Ÿè®¡å‘˜å·¥çš„å¹³å‡å¹´é¾„
select max(age) from emp; # ç»Ÿè®¡å‘˜å·¥çš„æœ€å¤§å¹´é¾„
select min(age) from emp; # ç»Ÿè®¡å‘˜å·¥çš„æœ€å°å¹´é¾„
select sum(age) from emp where workaddress = "è¥¿å®‰" ; 
```

### åˆ†ç»„æŸ¥è¯¢

```sql
select å­—æ®µåˆ—è¡¨ from è¡¨å where æ¡ä»¶ group by åˆ†ç»„å­—æ®µå having åˆ†ç»„åçš„è¿‡æ»¤æ¡ä»¶
```

- where ä¸havingåŒºåˆ«

  æ‰§è¡Œæ—¶æœºä¸åŒï¼š where æ˜¯åˆ†ç»„ä¹‹å‰è¿›è¡Œè¿‡æ»¤ ä¸æ»¡è¶³whereæ¡ä»¶ ä¸å‚ä¸åˆ†ç»„ï¼›è€Œhavingæ˜¯åˆ†ç»„ä¹‹åå¯¹ç»“æœè¿›è¡Œè¿‡æ»¤

- æ³¨æ„äº‹é¡¹

  åˆ†ç»„ä¹‹å æŸ¥è¯¢çš„å­—æ®µä¸€èˆ¬ä¸ºèšåˆå‡½æ•°å’Œåˆ†ç»„å­—æ®µ æŸ¥è¯¢å…¶ä»–å­—æ®µæ²¡æœ‰æ„ä¹‰

  æ‰§è¡Œé¡ºåº ï¼š where > èšåˆå‡½æ•° > having

  æ”¯æŒå¤šå­—æ®µåˆ†ç»„ ã€‚group by columAï¼ŒcolumnB

``` sql
# æ ¹æ®æ€§åˆ«åˆ†ç»„ ç»Ÿè®¡ç”·æ€§å‘˜å·¥å’Œå¥³æ€§å‘˜å·¥çš„æ•°é‡
select gender, count(*) from emp group by gender ; 
# æ ¹æ®æ€§åˆ«åˆ†ç»„ , ç»Ÿè®¡ç”·æ€§å‘˜å·¥ å’Œ å¥³æ€§å‘˜å·¥çš„å¹³å‡å¹´é¾„
select gender, avg(age) from emp group by gender ;
# æŸ¥è¯¢å¹´é¾„å°äº45çš„å‘˜å·¥ , å¹¶æ ¹æ®å·¥ä½œåœ°å€åˆ†ç»„ , è·å–å‘˜å·¥æ•°é‡å¤§äºç­‰äº3çš„å·¥ä½œåœ°å€
select workaddress, count(*) address_count from emp where age < 45 group by workaddress having address_count >= 3;

# ç»Ÿè®¡å„ä¸ªå·¥ä½œåœ°å€ä¸Šç­çš„ç”·æ€§ä»¥åŠå¥³æ€§å‘˜å·¥çš„æ•°é‡
select workaddress , gender ,count(*) 'æ•°é‡' from emp group by gender , workaddress;
```

### æ’åºæŸ¥è¯¢

```sql
# æ ¹æ®å¹´é¾„å¯¹å…¬å¸çš„å‘˜å·¥è¿›è¡Œå‡åºæ’åº , å¹´é¾„ç›¸åŒ , å†æŒ‰ç…§å…¥èŒæ—¶é—´è¿›è¡Œé™åºæ’åº
select * from emp order by age asc , entrydate desc
```

### åˆ†é¡µæŸ¥è¯¢

è¯­æ³•

>select å­—æ®µåˆ—è¡¨ from è¡¨å limit èµ·å§‹ç´¢å¼• ,  æŸ¥è¯¢è®°å½•æ•°;

- ==èµ·å§‹ç´¢å¼•ä»0å¼€å§‹ èµ·å§‹ç´¢å¼• = (æŸ¥è¯¢é¡µç  - 1) * æ¯é¡µæ˜¾ç¤ºè®°å½•æ•°==
- æŸ¥è¯¢ç¬¬ä¸€é¡µæ•°æ® èµ·å§‹ç´¢å¼•å¯ä»¥çœç•¥ ç›´æ¥ç®€å†™ä¸º limit 10;

```sql
# æŸ¥è¯¢ç¬¬1é¡µå‘˜å·¥æ•°æ® æ¯é¡µå±•ç¤º10æ¡è®°å½•
select * from emp limit 0 , 10;
select * from emp limit 10;
```

```sql
# æŸ¥è¯¢å¹´é¾„ä¸º 20ï¼Œ21ï¼Œ22ï¼Œ23çš„å‘˜å·¥ä¿¡æ¯
select * from emp where gender = 'å¥³' and age in (20,21,22,23);
# æŸ¥è¯¢æ€§åˆ«ä¸ºç”· ï¼Œå¹¶ä¸”å¹´é¾„åœ¨ 20 - 40å²ä»¥å†…çš„ å§“åä¸º ä¸‰ä¸ªå­—çš„å‘˜å·¥
select * from emp where gender = 'ç”·' and ( age between 20 and 40 ) and name like '___';
# ç»Ÿè®¡å‘˜å·¥è¡¨ä¸­ å¹´é¾„å°äº60å²çš„ ç”·æ€§å‘˜å·¥å’Œ å¥³æ€§å‘˜å·¥çš„æ€»äººæ•°
select gender, count(*) from emp where age < 60 group by gender;
# æŸ¥è¯¢æ€§åˆ«ä¸ºç”·ï¼Œä¸”å¹´é¾„åœ¨20-40 å²(å«)ä»¥å†…çš„å‰5ä¸ªå‘˜å·¥ä¿¡æ¯ï¼Œå¯¹æŸ¥è¯¢çš„ç»“æœæŒ‰å¹´é¾„å‡åºæ’åºï¼Œå¹´é¾„ç›¸åŒæŒ‰å…¥èŒæ—¶é—´å‡åºæ’åºã€‚
select * from emp where gender = 'ç”·' and age between 20 and 40 order by age asc ,entrydate asc limit 5 ;
```

### å¤šè¡¨æŸ¥è¯¢

#### è¿æ¥æŸ¥è¯¢

1. å†…è¿æ¥ ï¼š ç›¸å½“äºæŸ¥è¯¢ Aã€Bäº¤é™…éƒ¨åˆ†æ•°æ®

   ![image-20230325212805302](https://halo-1308808626.cos.ap-guangzhou.myqcloud.com/images/202303252128351.png)

   - éšå¼å†…è¿æ¥

     >select å­—æ®µåˆ—è¡¨ from è¡¨1ï¼Œè¡¨2 where æ¡ä»¶.......

     ```sql
     select e.name,d.name from emp e , dept d where e.dept_id = d.id;
     ```

   - æ˜¾ç¤ºå†…è¿æ¥

     >SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨1 [ INNER ] JOIN è¡¨2 ON è¿æ¥æ¡ä»¶ ... ;

     ```sql
     select e.name, d.name from emp e join dept d on e.dept_id = d.id;
     ```

2. å¤–è¿æ¥

   ![image-20230325213201351](https://halo-1308808626.cos.ap-guangzhou.myqcloud.com/images/202303252132397.png)

   - å·¦å¤–è¿æ¥

     å·¦å¤–è¿æ¥ç›¸å½“äºæŸ¥è¯¢è¡¨1(å·¦è¡¨)çš„æ‰€æœ‰æ•°æ®ï¼Œå½“ç„¶ä¹ŸåŒ…å«è¡¨1å’Œè¡¨2äº¤é›†éƒ¨åˆ†çš„æ•°æ®ã€‚

     >SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨1 LEFT [ OUTER ] JOIN è¡¨2 ON æ¡ä»¶ ... ; 

     ```sql
      æŸ¥è¯¢empè¡¨çš„æ‰€æœ‰æ•°æ®, å’Œå¯¹åº”çš„éƒ¨é—¨ä¿¡æ¯
      ç”±äºéœ€æ±‚ä¸­æåˆ°ï¼Œè¦æŸ¥è¯¢empçš„æ‰€æœ‰æ•°æ®ï¼Œæ‰€ä»¥æ˜¯ä¸èƒ½å†…è¿æ¥æŸ¥è¯¢çš„ï¼Œéœ€è¦ è€ƒè™‘ä½¿ç”¨å¤–è¿æ¥æŸ¥è¯¢ã€‚
      
      select e.*, d.name from emp e left join dept d on e.dept_id = d.id; æˆ–è€…
      select e.*, d.name from emp e left outer join dept d on e.dept_id = d.id;
     ```

     

   - å³å¤–è¿æ¥

     å³å¤–è¿æ¥ç›¸å½“äºæŸ¥è¯¢è¡¨2(å³è¡¨)çš„æ‰€æœ‰æ•°æ®ï¼Œå½“ç„¶ä¹ŸåŒ…å«è¡¨1å’Œè¡¨2äº¤é›†éƒ¨åˆ†çš„æ•°æ®ã€‚

     >SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨1 RIGHT [ OUTER ] JOIN è¡¨2 ON æ¡ä»¶ ... 

     ```sql
     æŸ¥è¯¢deptè¡¨çš„æ‰€æœ‰æ•°æ®, å’Œå¯¹åº”çš„å‘˜å·¥ä¿¡æ¯(å³å¤–è¿æ¥)  ç”±äºéœ€æ±‚ä¸­æåˆ°ï¼Œè¦æŸ¥è¯¢deptè¡¨çš„æ‰€æœ‰æ•°æ®ï¼Œæ‰€ä»¥æ˜¯ä¸èƒ½å†…è¿æ¥æŸ¥è¯¢çš„ï¼Œéœ€è¦è€ƒè™‘ä½¿ç”¨å¤–è¿æ¥æŸ¥è¯¢ã€‚
     select d.*, e.* from emp e right outer join dept d on e.dept_id = d.id;  æˆ–è€… 
     select d.*, e.* from dept d left outer join emp e on e.dept_id = d.id;
     ```

   >å·¦å¤–è¿æ¥å’Œå³å¤–è¿æ¥æ˜¯å¯ä»¥ç›¸äº’æ›¿æ¢çš„ï¼Œåªéœ€è¦è°ƒæ•´åœ¨è¿æ¥æŸ¥è¯¢æ—¶SQLä¸­ï¼Œè¡¨ç»“æ„çš„å…ˆåé¡ºåºå°±å¯ä»¥äº†ã€‚è€Œæˆ‘ä»¬åœ¨æ—¥å¸¸å¼€å‘ä½¿ç”¨æ—¶ï¼Œæ›´åå‘äºå·¦å¤–è¿æ¥ã€‚

3. å·¦å¤–è¿æ¥ï¼š æŸ¥è¯¢å·¦è¡¨æ‰€æœ‰æ•°æ®ï¼Œä»¥åŠä¸¤å¼ è¡¨äº¤é›†éƒ¨åˆ†æ•°æ®

4. å³å¤–è¿æ¥ :  æ’å™å³è¡¨æ‰€æœ‰æ•°æ® ä»¥åŠä¸¤å¼ è¡¨äº¤é›†éƒ¨éƒ¨åˆ†æ•°æ®

5. è‡ªè¿æ¥ï¼š å½“å‰è¡¨ä¸è‡ªèº«çš„è¿æ¥æŸ¥è¯¢ è‡ªè¿æ¥å¿…é¡»ä½¿ç”¨åˆ«å

#### è”åˆæŸ¥è¯¢

unionæŸ¥è¯¢ï¼Œå°±æ˜¯æŠŠå¤šæ¬¡æŸ¥è¯¢çš„ç»“æœåˆå¹¶èµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªæ–°çš„æŸ¥è¯¢ç»“æœé›†ã€‚

```sql
SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨A ...
UNION [ ALL ]
SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨B ....;
```

>å¯¹äºè”åˆæŸ¥è¯¢çš„å¤šå¼ è¡¨çš„åˆ—æ•°å¿…é¡»ä¿æŒä¸€è‡´ï¼Œå­—æ®µç±»å‹ä¹Ÿéœ€è¦ä¿æŒä¸€è‡´ã€‚
>
>union all ä¼šå°†å…¨éƒ¨çš„æ•°æ®ç›´æ¥åˆå¹¶åœ¨ä¸€èµ·ï¼Œunion ä¼šå¯¹åˆå¹¶ä¹‹åçš„æ•°æ®å»é‡ã€‚

-  å°†è–ªèµ„ä½äº 5000 çš„å‘˜å·¥ , å’Œ å¹´é¾„å¤§äº 50 å²çš„å‘˜å·¥å…¨éƒ¨æŸ¥è¯¢å‡ºæ¥.

  ```sql
  select * from emp where salary < 5000
  union (all) # åŠ äº†all ä¸ä¼šå¯¹æŸ¥è¯¢å‡ºæ¥çš„ç»“æœè¿›è¡Œå»é‡å¤„ç†ã€‚
  select * from emp where age > 50;
  ```

>å¦‚æœå¤šæ¡æŸ¥è¯¢è¯­å¥æŸ¥è¯¢å‡ºæ¥çš„ç»“æœï¼Œå­—æ®µæ•°é‡ä¸ä¸€è‡´ï¼Œåœ¨è¿›è¡Œunion/union allè”åˆæŸ¥è¯¢æ—¶ï¼Œå°†ä¼šæŠ¥é”™ã€‚

#### å­æŸ¥è¯¢

SQLè¯­å¥ä¸­åµŒå¥—SELECTè¯­å¥ï¼Œç§°ä¸ºåµŒå¥—æŸ¥è¯¢ï¼Œåˆç§°å­æŸ¥è¯¢ã€‚

```sql
SELECT * FROM t1 WHERE column1 = ( SELECT column1 FROM t2 );
```

æ ¹æ®å­æŸ¥è¯¢ç»“æœä¸åŒï¼Œåˆ†ä¸ºï¼š

- æ ‡é‡å­æŸ¥è¯¢ï¼ˆå­æŸ¥è¯¢ç»“æœä¸ºå•ä¸ªå€¼ï¼‰

  >å­æŸ¥è¯¢è¿”å›çš„ç»“æœæ˜¯å•ä¸ªå€¼ï¼ˆæ•°å­—ã€å­—ç¬¦ä¸²ã€æ—¥æœŸç­‰ï¼‰ï¼Œæœ€ç®€å•çš„å½¢å¼ï¼Œè¿™ç§å­æŸ¥è¯¢ç§°ä¸ºæ ‡é‡å­æŸ¥è¯¢ã€‚å¸¸ç”¨çš„æ“ä½œç¬¦ï¼š= <> > >= < <= 

  ```sql
  # æŸ¥è¯¢ "é”€å”®éƒ¨" çš„æ‰€æœ‰å‘˜å·¥ä¿¡æ¯
  select * from emp where dept_id = (select id from dept where name = 'é”€å”®éƒ¨');
  # æŸ¥è¯¢åœ¨ "æ–¹ä¸œç™½" å…¥èŒä¹‹åçš„å‘˜å·¥ä¿¡æ¯
  select * from emp where entrydate > (select entrydate from emp where name = 'æ–¹ä¸œç™½');
  ```

- åˆ—å­æŸ¥è¯¢(å­æŸ¥è¯¢ç»“æœä¸ºä¸€åˆ—)

  ![image-20230325215310266](https://halo-1308808626.cos.ap-guangzhou.myqcloud.com/images/202303252153319.png)

  >å­æŸ¥è¯¢è¿”å›çš„ç»“æœæ˜¯ä¸€åˆ—ï¼ˆå¯ä»¥æ˜¯å¤šè¡Œï¼‰ï¼Œè¿™ç§å­æŸ¥è¯¢ç§°ä¸ºåˆ—å­æŸ¥è¯¢ã€‚
  >
  >å¸¸ç”¨çš„æ“ä½œç¬¦ï¼šIN ã€NOT IN ã€ ANY ã€SOME ã€ ALL

  ```sql
  # æŸ¥è¯¢ "é”€å”®éƒ¨" å’Œ "å¸‚åœºéƒ¨" çš„æ‰€æœ‰å‘˜å·¥ä¿¡æ¯
  select * from emp where dept_id in (select id from dept where name = 'é”€å”®éƒ¨' or name = 'å¸‚åœºéƒ¨');
  
  # æŸ¥è¯¢æ¯” è´¢åŠ¡éƒ¨ æ‰€æœ‰äººå·¥èµ„éƒ½é«˜çš„å‘˜å·¥ä¿¡æ¯
  select * from emp where salary > all ( select salary from emp where dept_id = (select id from dept where name = 'è´¢åŠ¡éƒ¨') );
  ```

- è¡Œå­æŸ¥è¯¢(å­æŸ¥è¯¢ç»“æœä¸ºä¸€è¡Œ)

  >å­æŸ¥è¯¢è¿”å›çš„ç»“æœæ˜¯ä¸€è¡Œï¼ˆå¯ä»¥æ˜¯å¤šåˆ—ï¼‰ï¼Œè¿™ç§å­æŸ¥è¯¢ç§°ä¸ºè¡Œå­æŸ¥è¯¢ã€‚
  >
  >å¸¸ç”¨çš„æ“ä½œç¬¦ï¼š= ã€<> ã€IN ã€NOT IN

  ```sql
  # æŸ¥è¯¢ä¸ "å¼ æ— å¿Œ" çš„è–ªèµ„åŠç›´å±é¢†å¯¼ç›¸åŒçš„å‘˜å·¥ä¿¡æ¯ ;
  select * from emp where (salary,managerid) = (select salary, managerid from emp where name = 'å¼ æ— å¿Œ');
  ```

- è¡¨å­æŸ¥è¯¢(å­æŸ¥è¯¢ç»“æœä¸ºå¤šè¡Œå¤šåˆ—)

  >å­æŸ¥è¯¢è¿”å›çš„ç»“æœæ˜¯å¤šè¡Œå¤šåˆ—ï¼Œè¿™ç§å­æŸ¥è¯¢ç§°ä¸ºè¡¨å­æŸ¥è¯¢ã€‚å¸¸ç”¨çš„æ“ä½œç¬¦ï¼šIN

  ```sql
  # æŸ¥è¯¢ä¸ "é¹¿æ–å®¢" , "å®‹è¿œæ¡¥" çš„èŒä½å’Œè–ªèµ„ç›¸åŒçš„å‘˜å·¥ä¿¡æ¯
  select * from emp where (job,salary) in ( select job, salary from emp where name = 'é¹¿æ–å®¢' or name = 'å®‹è¿œæ¡¥' );
  
  # æŸ¥è¯¢å…¥èŒæ—¥æœŸæ˜¯ "2006-01-01" ä¹‹åçš„å‘˜å·¥ä¿¡æ¯ , åŠå…¶éƒ¨é—¨ä¿¡æ¯
  select e.*, d.* from (select * from emp where entrydate > '2006-01-01') e left join dept d on e.dept_id = d.id ;
  ```

## DCL

æ•°æ®æ§åˆ¶è¯­è¨€ï¼Œç”¨æ¥åˆ›å»ºæ•°æ®åº“ç”¨æˆ·ã€æ§åˆ¶æ•°æ®åº“çš„è®¿é—®æƒé™

1. æŸ¥è¯¢ç”¨æˆ·

   ```sql
   select * from mysql.user;
   ```

2. åˆ›å»ºç”¨æˆ·

   ```sql
   create user 'ç”¨æˆ·å'@'ä¸»æœºå' IDENTIFIED BY 'å¯†ç '
   
   eg: create user 'self'@'%' identified by '779500' # è¯¥ç”¨æˆ·å¯ä»¥ä»»æ„ä¸»æœºè®¿é—®æ•°æ®åº“ 
   ```

3. ä¿®æ”¹ç”¨æˆ·å¯†ç 

   ```sql
   ALTER USER 'ç”¨æˆ·å'@'ä¸»æœºå' IDENTIFIED WITH mysql_native_password BY 'æ–°å¯†ç ' ;
   
   eg: alter user 'heima'@'%' identified with mysql_native_password by '1234';
   ```

4. åˆ é™¤ç”¨æˆ·

   ```sql
   DROP USER 'ç”¨æˆ·å'@'ä¸»æœºå' ;
   
   eg: drop user 'itcast'@'localhost';
   ```

>åœ¨MySQLä¸­éœ€è¦é€šè¿‡ç”¨æˆ·å@ä¸»æœºåçš„æ–¹å¼ï¼Œæ¥å”¯ä¸€æ ‡è¯†ä¸€ä¸ªç”¨æˆ·ã€‚
>
>ä¸»æœºåå¯ä»¥ä½¿ç”¨ % é€šé…ã€‚

### æƒé™æ§åˆ¶

![image-20230325211303450](https://halo-1308808626.cos.ap-guangzhou.myqcloud.com/images/202303252113580.png)

1. æŸ¥è¯¢æƒé™

   ```sql
   SHOW GRANTS FOR 'ç”¨æˆ·å'@'ä¸»æœºå' ;
   
   eg: show grants for 'self'@'%'
   ```

2. æˆäºˆæƒé™

   ```sql
   GRANT æƒé™åˆ—è¡¨ ON æ•°æ®åº“å.è¡¨å TO 'ç”¨æˆ·å'@'ä¸»æœºå';
   
   # æˆäºˆ 'self'@'%'ç”¨æˆ·itcastæ•°æ®åº“æ‰€æœ‰è¡¨çš„æ‰€æœ‰æ“ä½œæƒé™
   grant all on itcast.* to 'self'@'%';
   ```

3. æ’¤é”€æƒé™

   ```sql
   REVOKE æƒé™åˆ—è¡¨ ON æ•°æ®åº“å.è¡¨å FROM 'ç”¨æˆ·å'@'ä¸»æœºå';
   
   eg: revoke all on itcast.* from 'heima'@'%';
   ```

   >å¤šä¸ªæƒé™ä¹‹é—´ï¼Œä½¿ç”¨é€—å·åˆ†éš”
   >
   >æˆæƒæ—¶ï¼Œ æ•°æ®åº“åå’Œè¡¨åå¯ä»¥ä½¿ç”¨ * è¿›è¡Œé€šé…ï¼Œä»£è¡¨æ‰€æœ‰ã€‚

   

# ç´¢å¼•

å¸®åŠ© mysqlé«˜æ•ˆè·å–æ•°æ®çš„æ•°æ®ç»“æ„(æœ‰åº)ã€‚åœ¨æ•°æ®ä¹‹å¤–ï¼Œæ•°æ®åº“ç³»ç»Ÿè¿˜ç»´æŠ¤ç€æ»¡è¶³ç‰¹å®šæŸ¥æ‰¾ç®—æ³•çš„æ•°æ®ç»“æ„ï¼Œè¿™äº›æ•°æ®ç»“æ„ä»¥æŸç§æ–¹å¼å¼•ç”¨ï¼ˆæŒ‡å‘ï¼‰æ•°æ®ï¼Œ è¿™æ ·å°±å¯ä»¥åœ¨è¿™äº›æ•°æ®ç»“æ„ä¸Šå®ç°é«˜çº§æŸ¥æ‰¾ç®—æ³•ï¼Œè¿™ç§æ•°æ®ç»“æ„å°±æ˜¯ç´¢å¼•ã€‚

![image-20230326015334719](https://halo-1308808626.cos.ap-guangzhou.myqcloud.com/images/202303260153772.png)

## ç»“æ„

![image-20230326015448997](https://halo-1308808626.cos.ap-guangzhou.myqcloud.com/images/202303260154055.png)

![image-20230326015512240](https://halo-1308808626.cos.ap-guangzhou.myqcloud.com/images/202303260155290.png)

## äºŒå‰æ ‘

åœ¨ MySQLçš„ç´¢å¼•ç»“æ„ä¸­ é€‰æ‹© B+Treeä½œä¸ºç´¢å¼•ç»“æ„

é€‰æ‹©äºŒå‰æ ‘ä½œä¸ºç´¢å¼•ç»“æ„ä¼šå­˜åœ¨ï¼š

>é¡ºåºæ’å…¥æ—¶ï¼Œä¼šå½¢æˆä¸€ä¸ªé“¾è¡¨ï¼ŒæŸ¥è¯¢æ€§èƒ½å¤§å¤§é™ä½ã€‚
>
>å¤§æ•°æ®é‡æƒ…å†µä¸‹ï¼Œå±‚çº§è¾ƒæ·±ï¼Œæ£€ç´¢é€Ÿåº¦æ…¢ã€‚

é€‰æ‹©çº¢é»‘æ ‘ä½œä¸ºç´¢å¼•ç»“æ„ ä¼šå­˜åœ¨ï¼š

>å¤§æ•°æ®é‡æƒ…å†µä¸‹ï¼Œå±‚çº§è¾ƒæ·±ï¼Œæ£€ç´¢é€Ÿåº¦æ…¢ã€‚

## B-Tree

B-Treeï¼ŒBæ ‘æ˜¯ä¸€ç§å¤šå‰è·¯è¡¡æŸ¥æ‰¾æ ‘ï¼Œç›¸å¯¹äºäºŒå‰æ ‘ï¼ŒBæ ‘æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥æœ‰å¤šä¸ªåˆ†æ”¯ï¼Œå³å¤šå‰ã€‚ä»¥ä¸€é¢—æœ€å¤§åº¦æ•°ï¼ˆmax-degreeï¼‰ä¸º5(5é˜¶)çš„b-treeä¸ºä¾‹ï¼Œé‚£è¿™ä¸ªBæ ‘æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šå­˜å‚¨4ä¸ªkeyï¼Œ5ä¸ªæŒ‡é’ˆ

## B+Tree

B-Treeçš„å˜ç§

B+Tree ä¸ B-Treeç›¸æ¯”ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ç‚¹åŒºåˆ«ï¼š

>- æ‰€æœ‰çš„æ•°æ®éƒ½ä¼šå‡ºç°åœ¨å¶å­èŠ‚ç‚¹ã€‚
>- å¶å­èŠ‚ç‚¹å½¢æˆä¸€ä¸ªå•å‘é“¾è¡¨ã€‚
>- éå¶å­èŠ‚ç‚¹ä»…ä»…èµ·åˆ°ç´¢å¼•æ•°æ®ä½œç”¨ï¼Œå…·ä½“çš„æ•°æ®éƒ½æ˜¯åœ¨å¶å­èŠ‚ç‚¹å­˜æ”¾çš„ã€‚

## Hash

å“ˆå¸Œç´¢å¼•å°±æ˜¯é‡‡ç”¨ä¸€å®šçš„hashç®—æ³• å°†é”®å€¼æ¢ç®—æˆæ–°çš„hashå€¼ æ˜ å°„åˆ°å¯¹åº”çš„æ§½ä½ä¸Šï¼Œç„¶åå­˜å‚¨åœ¨hashè¡¨ä¸­

ç‰¹ç‚¹

>-  Hashç´¢å¼•åªèƒ½ç”¨äºå¯¹ç­‰æ¯”è¾ƒ(=ï¼Œin)ï¼Œä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼ˆbetweenï¼Œ>ï¼Œ< ï¼Œ...ï¼‰
>- æ— æ³•åˆ©ç”¨ç´¢å¼•å®Œæˆæ’åºæ“ä½œ
>- æŸ¥è¯¢æ•ˆç‡é«˜ï¼Œé€šå¸¸(ä¸å­˜åœ¨hashå†²çªçš„æƒ…å†µ)åªéœ€è¦ä¸€æ¬¡æ£€ç´¢å°±å¯ä»¥äº†ï¼Œæ•ˆç‡é€šå¸¸è¦é«˜äºB+treeç´¢å¼•

å­˜å‚¨åº“æ”¯æŒ

åœ¨MySQLä¸­ï¼Œæ”¯æŒhashç´¢å¼•çš„æ˜¯Memoryå­˜å‚¨å¼•æ“ã€‚ è€ŒInnoDBä¸­å…·æœ‰è‡ªé€‚åº”hashåŠŸèƒ½ï¼Œhashç´¢å¼•æ˜¯InnoDBå­˜å‚¨å¼•æ“æ ¹æ®B+Treeç´¢å¼•åœ¨æŒ‡å®šæ¡ä»¶ä¸‹è‡ªåŠ¨æ„å»ºçš„ã€‚

## ç´¢å¼•åˆ†ç±»

![image-20230326020644121](https://halo-1308808626.cos.ap-guangzhou.myqcloud.com/images/202303260206185.png)

### èšé›†ç´¢å¼• äºŒçº§ç´¢å¼•

åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œæ ¹æ®ç´¢å¼•çš„å­˜å‚¨å½¢å¼ï¼Œåˆå¯ä»¥åˆ†ä¸ºä»¥ä¸‹ä¸¤ç§ï¼š

| åˆ†ç±»                     | å«ä¹‰                                                       | ç‰¹ç‚¹                |
| ------------------------ | ---------------------------------------------------------- | ------------------- |
| èšé›†ç´¢å¼•(ClusteredIndex) | å°†æ•°æ®å­˜å‚¨ä¸ç´¢å¼•æ”¾åˆ°äº†ä¸€å—ï¼Œç´¢å¼•ç»“æ„çš„å¶å­èŠ‚ç‚¹ä¿å­˜äº†è¡Œæ•°æ® | å¿…é¡»æœ‰,è€Œä¸”åªæœ‰ä¸€ä¸ª |
| äºŒçº§ç´¢å¼•(SecondaryIndex) | å°†æ•°æ®ä¸ç´¢å¼•åˆ†å¼€å­˜å‚¨ï¼Œç´¢å¼•ç»“æ„çš„å¶å­èŠ‚ç‚¹å…³è”çš„æ˜¯å¯¹åº”çš„ä¸»é”® | å¯ä»¥å­˜åœ¨å¤šä¸ª        |

èšé›†ç´¢å¼•é€‰å–è§„åˆ™ï¼š

å¦‚æœå­˜åœ¨ç´¢å¼• ä¸»é”®ç´¢å¼•å°±æ˜¯èšé›†ç´¢å¼•

å¦‚æœä¸å­˜åœ¨ä¸»é”®ï¼Œå°†ä½¿ç”¨ç¬¬ä¸€ä¸ªå”¯ä¸€ï¼ˆUNIQUEï¼‰ç´¢å¼•ä½œä¸ºèšé›†ç´¢å¼•ã€‚

å¦‚æœè¡¨æ²¡æœ‰ä¸»é”®ï¼Œæˆ–æ²¡æœ‰åˆé€‚çš„å”¯ä¸€ç´¢å¼•ï¼Œåˆ™InnoDBä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªrowidä½œä¸ºéšè—çš„èšé›†ç´¢å¼•ã€‚

### ç´¢å¼•è¯­æ³•

#### åˆ›å»ºç´¢å¼•

```sql
CREATE [ UNIQUE | FULLTEXT ] INDEX index_name ON table_name (
index_col_name,... ) ;

eg: CREATE INDEX idx_user_name ON tb_user(name);
```

#### æŸ¥çœ‹ç´¢å¼•

```sql
SHOW INDEX FROM table_name ;

egï¼š show index from tb_user;
```

####  åˆ é™¤ç´¢å¼•

```sql
DROP INDEX index_name ON table_name ;
```



# äº‹åŠ¡

äº‹åŠ¡ æ˜¯ä¸€ç»„æ“ä½œçš„é›†åˆï¼Œå®ƒæ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ï¼Œäº‹åŠ¡ä¼šæŠŠæ‰€æœ‰çš„æ“ä½œä½œä¸ºä¸€ä¸ªæ•´ä½“ä¸€èµ·å‘ç³»ç»Ÿæäº¤æˆ–æ’¤é”€æ“ä½œè¯·æ±‚ï¼Œå³è¿™äº›æ“ä½œè¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ã€‚

## æ§åˆ¶äº‹åŠ¡ä¸€

1. æŸ¥çœ‹ / è®¾ç½®äº‹åŠ¡æäº¤æ–¹å¼

   ```sql
   select @@autocommit ;
   set @@autocommit = 0;
   ```

2. æäº¤äº‹åŠ¡

   ```sql
   commit;
   ```

3. å›æ»šäº‹åŠ¡

   ```sql
   rollback;
   ```

>æ³¨æ„ï¼šä¸Šè¿°çš„è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬æ˜¯ä¿®æ”¹äº†äº‹åŠ¡çš„è‡ªåŠ¨æäº¤è¡Œä¸º, æŠŠé»˜è®¤çš„è‡ªåŠ¨æäº¤ä¿®æ”¹ä¸ºäº†æ‰‹åŠ¨æäº¤, æ­¤æ—¶æˆ‘ä»¬æ‰§è¡Œçš„DMLè¯­å¥éƒ½ä¸ä¼šæäº¤, éœ€è¦æ‰‹åŠ¨çš„æ‰§è¡Œcommitè¿›è¡Œæäº¤ã€‚

## æ§åˆ¶äº‹åŠ¡äºŒ

1. å¼€å¯äº‹åŠ¡

   ```sql
   START TRANSACTION æˆ– BEGIN;
   ```

2. æäº¤äº‹åŠ¡

   ```sql
   COMMIT;
   ```

3. å›æ»šäº‹åŠ¡

   ```sql
   ROLLBACK;
   ```

```sql
-- å¼€å¯äº‹åŠ¡
start transaction
-- 1. æŸ¥è¯¢å¼ ä¸‰ä½™é¢
select * from account where name = 'å¼ ä¸‰';
-- 2. å¼ ä¸‰çš„ä½™é¢å‡å°‘1000
update account set money = money - 1000 where name = 'å¼ ä¸‰';
-- 3. æå››çš„ä½™é¢å¢åŠ 1000
update account set money = money + 1000 where name = 'æå››';
-- å¦‚æœæ­£å¸¸æ‰§è¡Œå®Œæ¯•, åˆ™æäº¤äº‹åŠ¡
commit;
-- å¦‚æœæ‰§è¡Œè¿‡ç¨‹ä¸­æŠ¥é”™, åˆ™å›æ»šäº‹åŠ¡
-- rollback;
```

## äº‹åŠ¡å››å¤§ç‰¹æ€§ï¼ˆACIDï¼‰

- åŸå­æ€§ï¼ˆAtomicityï¼‰ï¼šäº‹åŠ¡æ˜¯ä¸å¯åˆ†å‰²çš„æœ€å°æ“ä½œå•å…ƒï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚
- ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼šäº‹åŠ¡å®Œæˆæ—¶ï¼Œå¿…é¡»ä½¿æ‰€æœ‰çš„æ•°æ®éƒ½ä¿æŒä¸€è‡´çŠ¶æ€ã€‚
- éš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼šæ•°æ®åº“ç³»ç»Ÿæä¾›çš„éš”ç¦»æœºåˆ¶ï¼Œä¿è¯äº‹åŠ¡åœ¨ä¸å—å¤–éƒ¨å¹¶å‘æ“ä½œå½±å“çš„ç‹¬ç«‹ç¯å¢ƒä¸‹è¿è¡Œã€‚
- æŒä¹…æ€§ï¼ˆDurabilityï¼‰ï¼šäº‹åŠ¡ä¸€æ—¦æäº¤æˆ–å›æ»šï¼Œå®ƒå¯¹æ•°æ®åº“ä¸­çš„æ•°æ®çš„æ”¹å˜å°±æ˜¯æ°¸ä¹…çš„ã€‚

# å­˜å‚¨å¼•æ“

>å­˜å‚¨å¼•æ“å°±æ˜¯å­˜å‚¨æ•°æ®ã€å»ºç«‹ç´¢å¼•ã€æ›´æ–°/æŸ¥è¯¢æ•°æ®ç­‰æŠ€æœ¯çš„å®ç°æ–¹å¼ ã€‚å­˜å‚¨å¼•æ“æ˜¯åŸºäºè¡¨çš„ï¼Œè€Œä¸æ˜¯åŸºäºåº“çš„ï¼Œæ‰€ä»¥å­˜å‚¨å¼•æ“ä¹Ÿå¯è¢«ç§°ä¸ºè¡¨ç±»å‹ã€‚æˆ‘ä»¬å¯ä»¥åœ¨åˆ›å»ºè¡¨çš„æ—¶å€™ï¼Œæ¥æŒ‡å®šé€‰æ‹©çš„å­˜å‚¨å¼•æ“ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šå°†è‡ªåŠ¨é€‰æ‹©é»˜è®¤çš„å­˜å‚¨å¼•æ“ã€‚

é»˜è®¤å­˜å‚¨å¼•æ“å°±æ˜¯ InnoDB

```sql
# å»ºè¡¨æ—¶æŒ‡å®šå­˜å‚¨å¼•æ“
CREATE TABLE è¡¨å(
å­—æ®µ1 å­—æ®µ1ç±»å‹ [ COMMENT å­—æ®µ1æ³¨é‡Š ] ,
......
å­—æ®µn å­—æ®µnç±»å‹ [COMMENT å­—æ®µnæ³¨é‡Š ]
) ENGINE = INNODB [ COMMENT è¡¨æ³¨é‡Š ] ;

# æŸ¥è¯¢å½“å‰æ•°æ®åº“æ”¯æŒçš„å­˜å‚¨å¼•æ“
show engines;
```

## ä¸‰ç§å­˜å‚¨å¼•æ“

### 1ã€InnoDB

mysqlçš„é»˜è®¤å­˜å‚¨å¼•æ“

InnoDBæ˜¯ä¸€ç§å…¼é¡¾é«˜å¯é æ€§å’Œé«˜æ€§èƒ½çš„é€šç”¨å­˜å‚¨å¼•æ“

>DMLæ“ä½œéµå¾ªACIDæ¨¡å‹ï¼Œæ”¯æŒäº‹åŠ¡ï¼›
>
>è¡Œçº§é”ï¼Œæé«˜å¹¶å‘è®¿é—®æ€§èƒ½ï¼›
>
>æ”¯æŒå¤–é”®FOREIGN KEYçº¦æŸï¼Œä¿è¯æ•°æ®çš„å®Œæ•´æ€§å’Œæ­£ç¡®æ€§ï¼›

>xxx.ibd : xxxä»£è¡¨çš„æ˜¯è¡¨å innoDBå¼•æ“çš„æ¯å¼ è¡¨éƒ½ä¼šå¯¹åº”è¿™æ ·ä¸€ä¸ªè¡¨ç©ºé—´æ–‡ä»¶ï¼Œå­˜å‚¨è¯¥è¡¨çš„è¡¨ç»“æ„ï¼ˆfrm-æ—©æœŸçš„ ã€sdi-æ–°ç‰ˆçš„ï¼‰ã€æ•°æ®å’Œç´¢å¼•ã€‚

### 2ã€MyISAM

>ä¸æ”¯æŒäº‹åŠ¡ï¼Œä¸æ”¯æŒå¤–é”®
>
>æ”¯æŒè¡¨é”ï¼Œä¸æ”¯æŒè¡Œé”
>
>è®¿é—®é€Ÿåº¦å¿«

### 3ã€ Memory

>å†…å­˜å­˜æ”¾
>
> hashç´¢å¼•ï¼ˆé»˜è®¤ï¼‰

![image-20230326014229171](https://halo-1308808626.cos.ap-guangzhou.myqcloud.com/images/202303260142238.png)



# canalå®ç°æ•°æ®åŒæ­¥